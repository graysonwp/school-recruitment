---
sidebar_position: 6
---

## 1 相关知识

### 1.1 快速幂算法

1. **求 $x^n$ 最简单的方法是通过循环将 $n$ 个 $x$ 乘起来**，**依次求 $x_1, x_2,..., x_n$**，**时间复杂度为 $O(n)$**，而**快速幂算法可将时间复杂度降低至 $O(log_2n)$**。
2. **快速幂算法实际上是二分思想的一种应用**，具体推导如下：
   1. $x^n = x^{n / 2} \times x^{n / 2}$，令 $n / 2$ 为整数，则需要分为奇偶两种情况（设向下取整除法符号为 `//`）：
      1. **当 $n$ 为偶数**：$x^n = (x^2)^{n // 2}$。
      2. **当 $n$ 为奇数**：$x^n = x(x^2)^{n // 2}$，即**会多出一项 $x$**。
3. **幂结果的获取方法**如下：
   1. **根据二分推导**，**可通过循环$x = x^2$操作**，**每次把幂从$n$降至$n // 2$**，**直至将幂降为0**。
   2. **设$res = 1$**，**则初始状态$x^n = x^n \times res$**，**在循环二分时**，**每当$n$为奇数时**，**将多出的一项$x$乘入$res$**，**则最终可化至$x^n = x^0 \times res = res$**，**返回$res$即可**。

      ![Picture2.png](https://ricear.com/media/202202/2022-02-08_1930410.5592932205133178.png)
4. 计算过程中**部分操作可转化为位运算**：
   1. **向下整除$n // 2$等价于右移一位**，即$n >> 1$。
   2. **取余数$n % 2$等价于判断二进制最右一位值**，即$n \& 1$。

## 2 相关题目

### 2.1 [数值的整数次方](https://leetcode-cn.com/problems/shu-zhi-de-zheng-shu-ci-fang-lcof)

#### 2.1.1 题目

实现 pow(x, n) ，即计算 x 的 n 次幂函数（即，xn）。不得使用库函数，同时不需要考虑大数问题。

**示例 1：**

```txt
输入：x = 2.00000, n = 10
输出：1024.00000
```

**示例 2：**

```txt
输入：x = 2.10000, n = 3
输出：9.26100
```

**示例 3：**

```txt
输入：x = 2.00000, n = -2
输出：0.25000
解释：2-2 = 1/22 = 1/4 = 0.25
```

**提示：**

* -100.0 < x < 100.0
* -231 <= n <= 231-1
* -104 <= xn <= 104

#### 2.1.2 问题分析

1. 可采用[快速幂算法](#1-1-快速幂算法)来求解。
2. 具体算法流程如下：
   1. **当$x = 0$时**，**直接返回0**，**避免后续$x = \frac1x$操作报错**。
   2. **初始化$res = 1$**。
   3. **当$n \lt 0$时**，**把问题转化至$n \ge 0$的范围内**，**即执行$x = \frac1x, n = -n$**。
   4. **循环计算**，**当$n = 0$时跳出**：
      1. **当$n \& 1$时**，**将当前$x$乘入$res$**，**即$res *= x$**。
      2. **执行$x = x^2$**，**即$x *= x$**。
      3. **执行$n$右移一位**，**即$n >>= 1$**。
   5. **返回$res$**。
3. 需要注意的是：
   1. **`Java`中 `int32`变量$n \in [-2147483648, 2147483647]$**，因此**当$n = -2147483648$时执行$n = -n$会因越界而赋值出错**，解决方法是**先将$n$存入 `long`类型变量$temp$**，**后面用$temp$操作即可**。

#### 2.1.3 参考代码

```java
/**
 * 剑指 Offer 16. 数值的整数次方
 * @param x 底数
 * @param n 指数
 * @return  x 的 n 次方
 */
public double myPow(double x, int n) {
    long temp = n;
    double res = 1.0;

    if (x == 0) {return 0;}

    if (temp < 0) {
        x = 1 / x;
        temp = -temp;
    }

    while (temp > 0) {
        if ((temp & 1) == 1) {res *= x;}
        x *= x;
        temp >>= 1;
    }

    return res;
}
```

## 参考文献

1. [剑指 Offer 16. 数值的整数次方](https://leetcode-cn.com/problems/shu-zhi-de-zheng-shu-ci-fang-lcof)。
2. [面试题 16. 数值的整数次方（快速幂，清晰图解）](https://leetcode-cn.com/problems/shu-zhi-de-zheng-shu-ci-fang-lcof/solution/mian-shi-ti-16-shu-zhi-de-zheng-shu-ci-fang-kuai-s)。
